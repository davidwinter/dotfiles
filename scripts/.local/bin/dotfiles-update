#!/usr/bin/env bash
set -euo pipefail

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/dotfiles}"

cd "$DOTFILES_DIR"

echo "ðŸ”„ Updating dotfiles..."

if git pull --rebase; then
    echo "âœ… Git pull successful"
else
    echo "âŒ Git pull failed" >&2
    exit 1
fi

echo

if dotfiles-migrate; then
    echo
    echo "âœ… Dotfiles updated successfully"
else
    echo "âŒ Migrations failed" >&2
    echo "   Your dotfiles are updated but migrations didn't complete" >&2
    echo "   Please fix the issue and run: dotfiles-migrate" >&2
    exit 1
fi
